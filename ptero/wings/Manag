#!/bin/bash

# ==============================
# ğŸ¨ COLORS & STYLING
# ==============================
R="\e[31m"; G="\e[32m"; Y="\e[33m"; B="\e[34m"; M="\e[35m"; C="\e[36m"
W="\e[97m"; N="\e[0m"; BOLD="\e[1m"; DIM="\e[2m"

SERVICE="wings"

# ==============================
# ğŸ” STATUS CHECKER
# ==============================
get_status() {
    if systemctl is-active --quiet $SERVICE; then
        echo -e "${G}â— ACTIVE${N}"
    else
        echo -e "${R}â—‹ INACTIVE${N}"
    fi
}

# ==============================
# ğŸ“º UI REFRESHED MENU
# ==============================
while true; do
    clear
    STATUS=$(get_status)
    UPTIME=$(systemctl show -p ActiveEnterTimestamp $SERVICE | cut -d'=' -f2)

    echo -e "${C}â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®${N}"
    echo -e "${C}â”‚${N}  ${BOLD}ğŸª½  WINGS CONTROL CENTER${N}                   ${C}â”‚${N}"
    echo -e "${C}â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤${N}"
    echo -e "${C}â”‚${N}  Status: ${STATUS}                                ${C}â”‚${N}"
    echo -e "${C}â”‚${N}  Since:  ${DIM}${UPTIME:-N/A}${N}                ${C}â”‚${N}"
    echo -e "${C}â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯${N}"
    echo
    echo -e "  ${C}[1]${N} ${BOLD}Start${N}     ${DIM}Launch the service${N}"
    echo -e "  ${C}[2]${N} ${BOLD}Restart${N}   ${DIM}Quick reload${N}"
    echo -e "  ${C}[3]${N} ${BOLD}Stop${N}      ${DIM}Shut down service${N}"
    echo -e "  ${M}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${N}"
    echo -e "  ${C}[4]${N} ${BOLD}Status${N}    ${DIM}Full systemctl output${N}"
    echo -e "  ${C}[5]${N} ${BOLD}Logs${N}      ${DIM}Real-time journal stream${N}"
    echo -e "  ${C}[6]${N} ${BOLD}Debug${N}     ${DIM}Run 'sudo wings' directly${N}"
    echo -e "  ${M}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${N}"
    echo -e "  ${R}[0]${N} ${BOLD}Exit${N}      ${DIM}Close manager${N}"
    echo
    echo -ne "  ${BOLD}Action:${N} "
    read -r choice

    case $choice in
        1)
            echo -e "\n${G}â³ Starting Wings...${N}"
            sudo systemctl start $SERVICE
            sleep 1.5
            ;;
        2)
            echo -e "\n${C}â™» Restarting Wings...${N}"
            sudo systemctl restart $SERVICE
            sleep 1.5
            ;;
        3)
            echo -e "\n${R}ğŸ›‘ Stopping Wings...${N}"
            sudo systemctl stop $SERVICE
            sleep 1.5
            ;;
        4)
            echo -e "\n${B}ğŸ“‹ System Status:${N}"
            systemctl status $SERVICE --no-pager
            echo
            read -p "Press [Enter] to return..."
            ;;
        5)
            echo -e "\n${Y}ğŸ“œ Streaming Logs (Ctrl+C to stop)...${N}"
            journalctl -u $SERVICE -f
            ;;
        6)
            echo -e "\n${R}âš ï¸  ENTERING DEBUG MODE${N}"
            echo -e "Stopping background service first..."
            sudo systemctl stop $SERVICE
            echo -e "${C}â–¶ Running: sudo wings${N}\n"
            sudo wings
            read -p "Press [Enter] to return to menu..."
            ;;
        0)
            echo -e "\n${Y}ğŸ‘‹ Goodbye!${N}"
            exit 0
            ;;
        *)
            echo -e "\n${R}âŒ Invalid choice.${N}"
            sleep 1
            ;;
    esac
done
